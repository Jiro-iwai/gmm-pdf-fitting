# Webアプリケーション アーキテクチャ

## 概要

FastAPI + React によるWebアプリケーション実装です。既存のGMMフィッティングコードをラップし、GUIでパラメータを指定して結果を可視化できます。

## アーキテクチャ図

```
┌─────────────────────────────────────────────────────────────┐
│                    React Frontend                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │ParameterForm │  │ResultDisplay │  │  PlotViewer  │    │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘    │
│         │                  │                  │             │
│         └──────────────────┴──────────────────┘            │
│                            │                                │
│                    HTTP POST /api/compute                   │
└────────────────────────────┼────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                    FastAPI Backend                          │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  /api/compute                                        │  │
│  │  - Request validation (Pydantic)                    │  │
│  │  - Call compute_gmm_fitting()                        │  │
│  │  - Generate plot (base64)                            │  │
│  │  - Return JSON response                              │  │
│  └──────────────────────────────────────────────────────┘  │
│                            │                                │
│                            ▼                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  compute_gmm_fitting()                               │  │
│  │  - Extract from main.py logic                        │  │
│  │  - Call em_method / lp_method                        │  │
│  │  - Compute statistics and errors                      │  │
│  └──────────────────────────────────────────────────────┘  │
└────────────────────────────┬────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────┐
│              Existing GMM Fitting Modules                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ em_method.py │  │ lp_method.py │  │ gmm_utils.py│      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

## コンポーネント詳細

### バックエンド（FastAPI）

#### `webapp/models.py`
- **Pydanticモデル**: リクエスト/レスポンスの型定義
- `ComputeRequest`: 入力パラメータのバリデーション
- `ComputeResponse`: 計算結果の構造化

#### `webapp/api.py`
- **FastAPIアプリケーション**: メインAPIサーバー
- `POST /api/compute`: メインの計算エンドポイント
- `GET /api/health`: ヘルスチェック
- CORS設定: Reactフロントエンドからのアクセスを許可

**主要関数:**
- `compute_gmm_fitting()`: 既存の`main.py`ロジックを関数化
- `generate_plot_base64()`: プロットをメモリ上で生成しbase64エンコード

### フロントエンド（React）

#### `src/App.jsx`
- メインアプリケーションコンポーネント
- 状態管理: `result`, `loading`, `error`
- API呼び出しとエラーハンドリング

#### `src/components/ParameterForm.jsx`
- パラメータ入力フォーム
- Material-UIのAccordionでセクション分け
- メソッド（EM/LP/Hybrid）に応じて動的にパラメータを表示

#### `src/components/ResultDisplay.jsx`
- 結果表示の統合コンポーネント
- プロット、統計量、エラーメトリクス、GMMコンポーネントを表示

#### `src/components/PlotViewer.jsx`
- プロット画像の表示コンポーネント
- base64エンコードされた画像を表示

#### `src/components/StatisticsTable.jsx`
- 統計量比較テーブル
- 真のPDFとGMM近似の統計量を比較

## データフロー

1. **ユーザー入力**: ParameterFormでパラメータを入力
2. **APIリクエスト**: `POST /api/compute` にJSONを送信
3. **バリデーション**: Pydanticモデルでリクエストを検証
4. **計算実行**: `compute_gmm_fitting()` でGMMフィッティングを実行
5. **プロット生成**: `generate_plot_base64()` でプロットを生成
6. **レスポンス**: JSON形式で結果を返す
7. **結果表示**: ResultDisplayコンポーネントで結果を表示

## 技術スタック

### バックエンド
- **FastAPI**: モダンなPython Webフレームワーク
- **Pydantic**: データバリデーション
- **Uvicorn**: ASGIサーバー
- **既存モジュール**: `em_method.py`, `lp_method.py`, `gmm_utils.py`

### フロントエンド
- **React 18**: UIライブラリ
- **Vite**: ビルドツール・開発サーバー
- **Material-UI (MUI)**: UIコンポーネントライブラリ
- **Axios**: HTTPクライアント（必要に応じて）

## セキュリティ考慮事項

1. **CORS**: 開発環境のみ許可（本番環境では適切に設定）
2. **入力バリデーション**: Pydanticモデルで厳密に検証
3. **エラーハンドリング**: 詳細なエラー情報を返さない（本番環境）

## パフォーマンス最適化

1. **プロット生成**: メモリ上で処理（一時ファイル不要）
2. **非同期処理**: FastAPIの非同期機能を活用（将来の拡張）
3. **レスポンスサイズ**: base64エンコードされた画像は大きいが、必要最小限

## 拡張可能性

### 追加可能な機能
1. **設定の保存/読み込み**: ローカルストレージまたはサーバー側
2. **計算履歴**: 過去の計算結果の保存
3. **バッチ処理**: 複数のパラメータセットの一括計算
4. **リアルタイム更新**: WebSocketを使用した進捗表示
5. **エクスポート機能**: CSV/JSON形式での結果エクスポート

### 改善点
1. **エラーメッセージ**: より詳細なエラー情報の提供
2. **ローディング状態**: 進捗バーの表示
3. **レスポンシブデザイン**: モバイル対応の改善
4. **テスト**: フロントエンド/バックエンドのユニットテスト

